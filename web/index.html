<html>
    <head>

    </head>

    <body>

        <video id="my-video" controls="controls" ></video>

        <div id="rollover-holder" style="margin-top: 30px;">
            <h1>Rollovers</h1>
        </div>

        <div id="screencaps-holder" style="margin-top: 30px;">
            <h1>Screencaps Example</h1>
        </div>

        <div id="screencaps-nw-holder" style="margin-top: 30px;">
            <h1>Screencaps (No Watermark) Example</h1>
        </div>

        <script>
            // basic helper to fetch query parameters
            function getQueryVariable(variable) {
                const params = new URLSearchParams(window.location.search);
                if (params.has(variable)) {
                    return params.get(variable);
                }
                return null;
            }

            function showError(msg) {
                const div = document.createElement('div');
                div.style.color = 'red';
                div.textContent = msg;
                document.body.appendChild(div);
            }
        </script>

        <script src="https://cdn.jwplayer.com/libraries/wC3EoP7c.js"></script>

        <script type="text/JavaScript">
            var file = getQueryVariable('file');
            var shoot = getQueryVariable('shoot');
            var numScreencaps = parseInt(getQueryVariable('num_screencaps'));
            var numRollovers = parseInt(getQueryVariable('num_rollovers'));

            if (!file || !shoot || isNaN(numScreencaps) || isNaN(numRollovers)) {
                showError('Missing or invalid query parameters');
            }

            var filePath = "../media/" + shoot + "/";

            var vttLocation = filePath + "sprite/" + shoot + "_thumbs.vtt";
            var spriteMapLocation = filePath + "sprite/" + shoot + "_sprite.jpg";
            var videoFileLocation = filePath + file + ".mp4";

            jwplayer("my-video").setup({
                "height": 360,
                "width": 640,
                "playlist": [{
                    "file": videoFileLocation,
                    "tracks": [{
                        "file": vttLocation,
                        "kind": "thumbnails"
                    }]
                }]
            }).on('error', function() {
                showError('Video failed to load: ' + videoFileLocation);
            });

            var screenCapToShow = Math.round((numScreencaps / 2) + 1);
            if (screenCapToShow < 10) { // add trailing 0
                screenCapToShow = "00" + screenCapToShow + ".jpg";
            } else if (screenCapToShow < 100) { // add trailing 0
                screenCapToShow = "0" + screenCapToShow + ".jpg";
            } else {
                screenCapToShow = screenCapToShow + ".jpg";
            }

            var firstScreencapLocation = filePath + "screencaps/" + screenCapToShow;
            var firstNWScreencapLocation = filePath + "screencapsnw/" + screenCapToShow;

            function createImg(src) {
                var img = document.createElement('img');
                img.src = src;
                img.onerror = function() { showError('Missing image: ' + src); };
                return img;
            }

            var screenCapsHolder = document.getElementById('screencaps-holder');
            screenCapsHolder.appendChild(createImg(firstScreencapLocation));

            var screenNWCapsHolder = document.getElementById('screencaps-nw-holder');
            screenNWCapsHolder.appendChild(createImg(firstNWScreencapLocation));

            // do rollovers
            var rolloversLocation = filePath + "rollover/180/";
            var rolloverHolder = document.getElementById('rollover-holder');

            for (var i = 1; i < (numRollovers + 1); i++) {
                rolloverHolder.appendChild(createImg(rolloversLocation + i + ".jpg"));
            }

        </script>

    </body>
</html>
